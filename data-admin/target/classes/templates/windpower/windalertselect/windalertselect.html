<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('表格数据汇总')"/>
    <script src="https://cdn.bootcss.com/echarts/4.4.0-rc.1/echarts.min.js"></script>
</head>
<body class="gray-bg">
<div id="chart-container"></div>
<div class="container-div">
    <div class="row">
        <div class="col-sm-12 search-collapse">
            <form id="time-form">
                <div class="select-list">
                    <ul>
                        <li class="select-time">
                            <label>创建时间： </label>
                            <input type="text" class="time-input" id="startTime" placeholder="开始时间"
                                   name="params[beginTime]"/>
                            <span>-</span>
                            <input type="text" class="time-input" id="endTime" placeholder="结束时间"
                                   name="params[endTime]"/>
                        </li>
                        <li>
                            <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i
                                    class="fa fa-search"></i>&nbsp;搜索</a>
                            <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset('time-form')"><i
                                    class="fa fa-refresh"></i>&nbsp;重置</a>
                        </li>
                        <li>
                            <a class="btn btn-info btn-rounded btn-sm" onclick="$.table.search()"><i
                                    class="fa fa-search"></i>&nbsp;导出</a>
                        </li>
                    </ul>
                </div>
            </form>
        </div>

        <div class="col-sm-12 select-table table-striped">
            <table id="bootstrap-table" data-mobile-responsive="true"></table>
        </div>

    </div>

</div>
<div th:include="include :: footer"></div>
<script th:inline="javascript">
    var prefix = ctx + "windpower/windalertselect";
    var datas = [[${@dict.getType('sys_normal_disable')}]];

    $(function () {
        var options = {
            url: prefix + "/list",
            showFooter: true,
            showSearch: false,
            showRefresh: false,
            showToggle: false,
            showColumns: false,
            columns: [{
                checkbox: true
            },
                {
                    field: 'id',
                    title: '序号'
                },
                {
                    field: 'create_time',
                    title: '统计时间'
                },
                {
                    field: 'fanId',
                    title: '风机编号'
                },
                {
                    field: 'vaneCount',
                    title: '叶片故障(次数)'
                },
                {
                    field: 'turnCount',
                    title: '转向故障(次数)'
                },
                {
                    field: 'dynamoCount',
                    title: '发电机故障(次数)'
                },
                {
                    field: 'elseCount',
                    title: '其他故障(次数)'
                },]
        };
        $.table.init(options);
    });
    $.ajax({
        url: 'http://localhost:8082/windpower/windalertselect/list',
        method: 'POST',
        data: {
            pageSize: 10,
            pageNum: 1,
            orderByColumn: '',
            isAsc: 'asc',
            'params[beginTime]': '',
            'params[endTime]': ''
        },
        success: function (response) {
            var data = response.rows;

            // 处理数据
            var xAxisData = []; // X 轴数据
            var vaneCountData = []; // 叶片故障数据
            var turnCountData = []; // 转向故障数据
            var dynamoCountData = []; // 发电机故障数据
            var elseCountData = []; // 其他故障数据

            data.forEach(function (item) {
                xAxisData.push(item.fanId);
                vaneCountData.push(item.vaneCount);
                turnCountData.push(item.turnCount);
                dynamoCountData.push(item.dynamoCount);
                elseCountData.push(item.elseCount);
            });

            // 更新图表配置项
            var option1 = {
                title: {
                    text: '风机故障统计',
                    textStyle: {
                        align: 'center',
                        color: '#fff',
                        fontSize: 20,
                    },
                    top: '3%',
                    left: '10%',
                },
                backgroundColor: '#0f375f',
                grid: {
                    top: '25%',
                    bottom: '10%',
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow',
                        label: {
                            show: true,
                        },
                    },
                },
                legend: {
                    data: ['叶片故障', '转向故障', '发电机故障', '其他故障'],
                    top: '15%',
                    textStyle: {
                        color: '#ffffff',
                    },
                },
                xAxis: {
                    data: xAxisData,
                    axisLine: {
                        show: true,
                    },
                    axisTick: {
                        show: true,
                    },
                    axisLabel: {
                        show: true,
                        textStyle: {
                            color: '#ebf8ac',
                        },
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#01FCE3',
                        },
                    },
                },
                yAxis: {
                    type: 'value',
                    name: '故障次数',
                    nameTextStyle: {
                        color: '#ebf8ac',
                    },
                    splitLine: {
                        show: false,
                    },
                    axisTick: {
                        show: true,
                    },
                    axisLine: {
                        show: true,
                    },
                    axisLabel: {
                        show: true,
                        textStyle: {
                            color: '#ebf8ac',
                        },
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#FFFFFF',
                        },
                    },
                },
                series: [
                    {
                        name: '叶片故障',
                        type: 'bar',
                        barWidth: 15,
                        itemStyle: {
                            color: 'rgba(29, 140, 248, 0.8)',
                        },
                        data: vaneCountData,
                    },
                    {
                        name: '转向故障',
                        type: 'bar',
                        barWidth: 15,
                        itemStyle: {
                            color: 'rgba(253, 115, 106, 0.8)',
                        },
                        data: turnCountData,
                    },
                    {
                        name: '发电机故障',
                        type: 'bar',
                        barWidth: 15,
                        itemStyle: {
                            color: 'rgba(102, 189, 106, 0.8)',
                        },
                        data: dynamoCountData,
                    },
                    {
                        name: '其他故障',
                        type: 'bar',
                        barWidth: 15,
                        itemStyle: {
                            color: 'rgba(247, 186, 23, 0.8)',
                        },
                        data: elseCountData,
                    },
                ],
            };

            // 渲染图表
            var chart = echarts.init(document.getElementById('chart-container'));
            chart.setOption(option1);
        },
        error: function (error) {
            console.log(error);
        },
    });

</script>
</body>
</html>